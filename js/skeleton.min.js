(function(e){e.extend(!0,e.mjs.nestedSortable.prototype,{toJson:function(t){function i(t){var r=e(t),s=r.find("> .menu-item-settings-wrapper input"),u={};s.each(function(){var t=e(this);u[t.attr("name")]=t.val()});if(r.children(n.listType).children(n.items).length>0){u.children=[];e(t).children(n.listType).children(n.items).each(function(){var e=i(this);u.children.push(e)})}return u}var n=e.extend({},this.options,t),r=[];e(this.element).children(n.items).each(function(){var e=i(this);r.push(e)});return r.length?JSON.stringify(r):null}});e.SitemapParser=function(){function y(t){var n=e('<div class="skeleton-error error"><span class="dismiss">&times;</span><p>'+t+"</p></div>").insertBefore("#skeleton-builder-frame");window.setTimeout(function(){e(n[0]).fadeOut(250,function(){e(this).remove()})},1e4)}function b(e){return l[S(l[e.pos]).parent]||{}}function w(e){return l[(e||{}).pos-1]||{}}function E(e){return l[e.pos+1]||{}}function S(e){return l[(e||{}).pos]||{}}function x(e,t){if(/^(.)\1+$/.test(e))return e.charCodeAt(0)===t.charCodeAt(0)+1;totalIt=function(e,t){var n=i=0;while(i<e.length){n+=String(e).charCodeAt(i)+(t&&i+1===e.length?1:0);i++}return n};return totalIt(e)===totalIt(t,!0)}function T(e,t){return e.type!==t.type?!1:e.type==="numeric"?parseInt(e.value)===parseInt(t.value)+1:!e.type.indexOf("roman-")&&!t.type.indexOf("roman-")?C(e.value)===C(t.value)+1:x(e.value,t.value)}function N(e){return(new Array(e+1)).join("-")}function C(e){var t=/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/,n=/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,r={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},i=0,s;e=e.toUpperCase();if(!e||!t.test(e))return!1;while(s=n.exec(e))i+=r[s[0]];return i}function k(e){return e.trim().toLowerCase().replace(/[\s]+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-{2,}/,"-")}function L(e,t){var n=e.charAt(0),r=w({pos:t})||{},i=(r.value||"").charAt(0);if(n.match(g.numeric))return"numeric";if(n.match(g.upper)){if(n.match(g.romanUpper)){if(r.type!=="uppercase")return"roman-uppercase";switch(n){case"I":if(i!=="H")return"roman-uppercase";break;case"V":if(i!=="U")return"roman-uppercase";break;case"X":if(i!=="W")return"roman-uppercase";break;case"L":if(i!=="K")return"roman-uppercase"}}return"uppercase"}if(n.match(g.lower)){if(!n.match(g.romanLower))return"lowercase";if(r.type!=="lowercase")return"roman-lowercase";switch(n){case"i":if(i!=="h")return"roman-lowercase";break;case"v":if(i!=="u")return"roman-lowercase";break;case"x":if(i!=="w")return"roman-lowercase";break;case"l":if(i!=="k")return"roman-lowercase"}}return n.match(g.romanLower)?r.type==="roman-lowercase"?"roman-lowercase":e.length>2?"roman-lowercase":t&&!r.value.charAt(0).match(g.romanPrevious)?"roman-lowercase":"test-roman":n.match(g.romanUpper)?r.type==="roman-uppercase"?"roman-uppercase":e.length>2?"roman-uppercase":t&&!r.value.charAt(0).match(g.romanPrevious)?"roman-uppercase":"test-roman":"unknown"}function A(e){var t=S(e),n=E(e);if(n.type==="roman-uppercase"){t.type="roman-uppercase";n.previousType="roman-uppercase"}else if(n.type==="roman-lowercase"){t.type="roman-lowercase";n.previousType="roman-lowercase"}}function O(t){var n=l.length,r=t.match(/^(\S+)\s(.*)/),i=r&&r.length>1?r[1].replace(/[.]/g,""):"";return r?{pos:n,previousType:n?w({pos:n}).type:!1,depth:null,type:L(i,n),parent:null,slug:k(r[2]),text:e.trim(r[2]),value:i,raw:{index:r[0],body:r[1]}}:!1}function M(){return u.find(":selected").data("hierarchical")}function _(){e("ul#sortable").nestedSortable({forcePlaceholderSize:!0,handle:".menu-item-handle",items:"li",opacity:.6,placeholder:"ui-state-highlight",tabSize:25,isTree:!0,startCollapsed:!0,toleranceElement:"> dl",listType:"ul",stop:function(){W()}})}function D(){var t=e("ul#sortable").find("li"),r=e('<ul id="sortable"></ul>');n.empty();e.each(t,function(e,t){r.append(t)});n.append(r);e("ul#sortable > li").addClass("mjs-nestedSortable-no-nesting");_()}function P(){h=!0;var n=t.val().split("\n");e.each(n,function(e,t){if(t.length){var n=O(t);n&&(l[n.pos]=n)}});var r=e.grep(l,function(e){return e.type==="test-roman"});e.each(r,function(e,t){A(t)});B()}function H(e,t){var n=S(e),r=w(e);if(n.pos===0){n.depth=n.parent=0;return n.depth}if(n.type===r.type&&T(n,r)){n.parent=r.parent;n.depth=r.depth;return n.depth}if(n.type===t.type&&T(n,t)){n.parent=t.parent;n.depth=t.depth;return n.depth}if(t.pos===t.parent&&T(n,t)){n.parent=t.pos;n.depth=t.depth;return n.depth}if(t.depth===0){f++;n.parent=r.pos;n.depth=f;return n.depth}H(n,b(t))}function B(){e.each(l,function(e,t){H(t,w(t))});q()}function j(e){var t='<dl class="menu-item-bar">';t+='<dt class="menu-item-handle">';t+='<span class="item-title">'+e.text+"</span>";t+='<span class="item-controls">';t+='<span class="item-order">';t+='<i class="up"><abbr title="Move up">↑</abbr></i>';t+='<i class="down"><abbr title="Move down">↓</abbr></i>';t+="</span>";t+="</span>";t+='<span class="addelement"><i class="add"><abbr title="Add Element">+</abbr></i></span>';t+="</dt>";t+="</dl>";t+='<div class="menu-item-settings-wrapper"><div class="menu-item-settings clearfix">';t+='<p class="description description-thin"><label>Navigation Label</label> <input type="text" name="label" value="'+e.text+'" /></p>';t+='<p class="description description-thin"><label>Permalink</label> <input type="text" name="permalink" value="'+e.slug+'" /></p>';t+='<p class="description description-thin"><label class="optional">Title Attribute</label> <input type="text" name="title" value="" /></p>';t+='<p class="description description-thin"><label class="optional">CSS Classes (optional)</label> <input type="text" name="cls" value="" /></p>';t+='<div class="menu-item-actions description-wide submitbox"><span class="delete">Remove</span> | <span class="cancel item-controls">Cancel</span></div>';t+="</div></div>";return t}function F(){var t=e('<ul id="sortable"></ul>'),n=0,r=null,i={},s={};e.each(l,function(o,u){var a=e('<li class="menuitem'+u.pos+'"></li>').html(j(u));s["menuitem"+u.pos]=a;if(u.depth===n)u.depth?r.after(a):t.append(a);else if(u.depth>n){if(!i["submenu"+u.parent]){i["submenu"+u.parent]=e('<ul class="submenu'+u.parent+'"></ul>');s["menuitem"+u.parent].append(i["submenu"+u.parent])}i["submenu"+u.parent].append(a)}else u.depth<n&&(u.depth?i["submenu"+u.parent].append(a):t.append(a));r=a;n=u.depth});return t}function I(){var t=[];e.each(l,function(e,n){t[e]=N(n.depth)+n.slug+":"+n.text});return t.join("\n")}function q(){if(c==="html"){n.empty().append(F());_()}else n.val(I());h=!1}function R(){document.getElementById("skeleton").addEventListener("dragover",function(e){e=e||event;e.preventDefault();o.addClass("dragover")},!1);document.getElementById("skeleton").addEventListener("dragleave",function(e){e=e||event;e.preventDefault();o.removeClass("dragover")},!1);window.addEventListener("dragover",function(e){e=e||event;e.preventDefault()});window.addEventListener("drop",function(e){e=e||event;e.preventDefault();o.removeClass("dragover");var n=e.target.files||e.dataTransfer.files,r=e.target.id||e.explicitOriginalTarget.id,i=e.dataTransfer.getData("text/plain");if(r==="skeleton")if(i){t.val(i);U();t.autosize()}else if((n[0]||{}).type==="text/plain"){var s=new FileReader;s.onload=function(e){t.val(e.target.result);U();t.autosize()};s.readAsText(n[0])}else y("<strong>"+(n[0]||{}).name+" - "+(n[0]||{}).type+" is not a supported file format.</strong> At this time only plain text files are supported.")},!1)}function U(){l.length&&(a=[],f=0,l=[]);P()}function z(){setTimeout(function(){if(p){p=!1;h||U()}},250)}function W(){if(!v){v=!0;s.addClass("locked");u.prop("disabled",!0);s.find(".clearSkeleton").length||u.after('<button type="button" class="unlock-button button-secondary"><span class="unlock-button-text">Unlock</span></button>')}}function X(){if(v){v=!1;U();u.prop("disabled",!1);u.next(".unlock-button").remove();s.removeClass("locked");M()||D()}}function V(){t.on("keyup",function(e){if(e.altKey||e.ctrlKey||e.metaKey)return;(e.which===13||e.which===8)&&t.autosize();if(String.fromCharCode(e.keyCode).match(/\w/)||e.keyCode===8||e.keyCode===46){p=!0;z()}}).on("paste",function(){t.autosize();p=!0;z()});s.on("click",".dismiss",function(){e(this).parent("div").fadeOut(250,function(){e(this).remove()})}).on("click",".clearSkeleton",function(){e(this).remove();t.val("");X();U()}).on("click",".unlock-button",function(){X()});n.on("keyup","input[name=label]",function(t){if(String.fromCharCode(t.keyCode).match(/\w/)||t.keyCode===8||t.keyCode===46){W();var n=e(this).closest("li.expanded");n.find(".menu-item-bar .item-title").html(e(this).val());n.find("input[name=permalink]:not(.edit)").val(k(e(this).val()))}}).on("keyup","input[name=permalink]",function(t){if(String.fromCharCode(t.keyCode).match(/\w/)||t.keyCode===8||t.keyCode===46){W();e(this).addClass("edit")}}).on("click",".addelement",function(){W();l[l.length]={};e(this).closest("li").after(e('<li class="menuitem'+l.length+' expanded"></li>').html(j({text:"New Menu Item",slug:"new-menu-item"})))}).on("click",".item-controls",function(){e(this).closest("li").toggleClass("expanded")}).on("click",".delete",function(){W();e(this).closest("li").remove()});r.on("click",J);u.on("change",function(){l.length&&W();M()?e("ul#sortable > li").removeClass("mjs-nestedSortable-no-nesting"):D()});window.File&&window.FileReader&&window.FileList&&window.Blob&&R()}function J(t){t.preventDefault();var i=e("ul#sortable").nestedSortable("toJson",{startDepthCount:0}),o=o||"admin-ajax.php",u=function(e){var t=n.closest(".menu-edit");e?t.addClass("submitted"):t.removeClass("submitted")};if(i){window.clearTimeout(d);u(!1);n.closest(".menu-edit").removeClass("submitted");r.spin({lines:10,length:3,width:1,radius:2,top:"auto",left:"-18px",color:"#000"});e.post(o,{action:"skeleton_builder",skeleton_builder_action:e("#skeleton_builder_action").val(),skeleton:i,skeleton_post_type:e("#skeleton_post_types").val(),skeleton_menu:e("#menu-name").val()},function(t){if(t.success===!0){r.spin(!1);s.find(".clearSkeleton").length||e(s.find("> .manage-menus > .button-secondary")[0]).after('<button class="alignright clearSkeleton button-secondary" type="button">Clear</button>');u(!0);d=window.setTimeout(function(){u(!1)},5e3)}else{r.spin(!1);e.each(t.data.errors,function(e,t){y(t)})}})}else y("Please build a menu before submitting.")}function K(){var i=arguments[0];t=i[0]||e("#skeleton");s=t.closest("form");o=t.parent("fieldset");n=i[1]||e("#skeleton-drag-area");r=i[2]||e(".build-skeleton-button");u=i[3]||e("#skeleton_post_types")}function Q(){K(arguments);V()}var t,n,r,s,o,u,a=[],f=0,l=[],c="html",h=!1,p=!1,d=!1,v=!1,m=!0,g={lowercase:/[a-z]/g,upper:/[A-Z]/g,romanLower:/[ivxl]/g,romanUpper:/[IVXL]/g,romanPrevious:/[hkuwHKUW]/g,numeric:/[0-9]/g};return{init:Q}}();e.SitemapParser.init()})(jQuery);